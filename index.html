<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>AR Park Control Panel</title>
  <script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
  <script src="https://cdn.jsdelivr.net/gh/AR-js-org/AR.js@3.4.2/aframe/build/aframe-ar.js"></script>
  <style>
    #ui-panel {
      position: fixed; top: 10px; left: 10px; z-index: 10001;
      background: rgba(0,0,0,0.7); color: white; padding: 15px;
      border-radius: 12px; box-shadow: 0 4px 10px rgba(0,0,0,0.3);
      font-family: 'Segoe UI', sans-serif; width: 240px; pointer-events: auto; user-select: none;
    }
    .model-btn { background: #8fff77; border: none; padding: 6px 10px; margin-right: 5px; margin-bottom: 5px; color: black; font-weight: bold; border-radius: 6px; cursor: pointer; font-size: 13px;}
    .model-btn:hover { background: #6ddb4c;}
    #infoPanel { display: none; background: #222; padding: 10px; border-radius: 8px; margin-top: 10px;}
    #infoPanel.show { display: block;}
    #loader { position:fixed;top:0;left:0;right:0;bottom:0;display:flex;align-items:center;justify-content:center;background:#000a;color:white;font-size:22px;z-index:10002;}
    #panel-toggle-btn { position: fixed; top: 10px; left: 10px; z-index: 10010; background: #8fff77; color: black; font-weight: bold; border: none; border-radius: 10px; padding: 10px 14px; font-size: 18px; cursor: pointer; opacity: 0.95;}
  </style>
</head>
<body>
  <div id="loader">Loading Tree Model...</div>
  <a-scene embedded arjs>
    <a-marker preset="hiro">
      <a-entity
        id="treeModel"
        obj-model="obj: models/tree.obj"
        material="src: models/texture.png"
        position="0 0 0"
        rotation="0 0 0"
        scale="1.5 1.5 1.5">
        <a-sound id="parkSound" src="url(sounds/park-sound.mp3)" autoplay="false" loop="true"></a-sound>
      </a-entity>
    </a-marker>
    <a-entity camera></a-entity>
  </a-scene>
  <button id="panel-toggle-btn" title="Show/Hide Control Panel">‚ò∞</button>
  <div id="ui-panel">
    <h3>AR Park Controls</h3>
    <div style="margin-bottom:10px">
      <button class="model-btn" id="soundBtn">üå≥ Play/Pause Sound</button>
      <button class="model-btn" id="rotateBtn">‚ü≥ Toggle Spin</button>
      <button class="model-btn" id="infoBtn">‚ÑπÔ∏è Info</button>
      <button class="model-btn" id="hideInfoBtn" style="display:none">Hide Info</button>
    </div>
    <div id="infoPanel"></div>
    <div class="footer-note">Point at the Hiro marker</div>
  </div>
  <script>
    const tree = document.getElementById('treeModel');
    const sound = tree.querySelector('#parkSound');
    const infoPanel = document.getElementById('infoPanel');
    const hideInfoBtn = document.getElementById('hideInfoBtn');
    const uiPanel = document.getElementById('ui-panel');
    const panelToggleBtn = document.getElementById('panel-toggle-btn');
    let spinning = false, spinAnim = null;

    // Sound control
    document.getElementById('soundBtn').addEventListener('click', () => {
      if (sound && sound.components.sound) {
        if (sound.components.sound.isPlaying) {
          sound.components.sound.pauseSound();
        } else {
          sound.components.sound.playSound();
        }
      }
    });

    // Toggle rotation animation
    document.getElementById('rotateBtn').addEventListener('click', () => {
      if (!spinning) {
        spinAnim = document.createElement('a-animation');
        spinAnim.setAttribute('attribute', 'rotation');
        spinAnim.setAttribute('to', '0 360 0');
        spinAnim.setAttribute('dur', '10000');
        spinAnim.setAttribute('repeat', 'indefinite');
        tree.appendChild(spinAnim);
      } else if (spinAnim) {
        tree.removeChild(spinAnim);
        tree.setAttribute('rotation', '0 0 0');
      }
      spinning = !spinning;
    });

    // Info panel
    document.getElementById('infoBtn').addEventListener('click', () => {
      infoPanel.innerHTML = "<strong>AR Tree Park:</strong> This tree spins and plays peaceful park sounds. Explore AR markers for more fun!";
      infoPanel.classList.add('show');
      hideInfoBtn.style.display = '';
    });
    hideInfoBtn.addEventListener('click', () => {
      infoPanel.classList.remove('show');
      hideInfoBtn.style.display = 'none';
    });

    // Loader hide
    tree.addEventListener('model-loaded', () => {
      document.getElementById('loader').style.display = 'none';
    });

    // Control panel toggle
    let panelVisible = true;
    panelToggleBtn.addEventListener('click', () => {
      panelVisible = !panelVisible;
      uiPanel.style.display = panelVisible ? '' : 'none';
      panelToggleBtn.textContent = panelVisible ? "‚úñ" : "‚ò∞";
      panelToggleBtn.title = panelVisible ? "Hide Control Panel" : "Show Control Panel";
    });
    // Init panel
    uiPanel.style.display = '';
    infoPanel.classList.remove('show');
    hideInfoBtn.style.display = 'none';
    panelToggleBtn.textContent = "‚úñ";
    panelToggleBtn.title = "Hide Control Panel";
  </script>
</body>
</html>
